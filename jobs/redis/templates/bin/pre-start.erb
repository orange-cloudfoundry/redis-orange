#!/bin/bash
<%- master=link('redis_conn')
  if master.p('replication') || master.p('cluster_enabled').eql?('yes')
    redis_persistance_rdb=0
    master.if_p('save') do |x|
      if !x.to_s.empty?
        redis_persistance_rdb=1
      end
    end
    if redis_persistance_rdb==0 && master.p('appendonly').eql?('no')
      if master.p('cluster_enabled').eql?('yes') 
        if master.p('cluster_replicas_per_node').to_i>0 -%>
sleep <%= (master.p('cluster_node_timeout').to_i*3)/2000 %>;
<%-     end
      else
        if master.p('replication') -%>
sleep <%= (master.p('down_after_milliseconds').to_i*3)/2000 %>;
<%-     end
      end
    end
  end
  if master.p('tls') -%>
DH_PARAM_FILE="<%= p('tls_keys_dir') %>/<%= p('tls_dh_params_file') %>";
if [[ ! -f ${DH_PARAM_FILE} ]];
then
  openssl dhparam -out ${DH_PARAM_FILE} <%= p('tls_dh_length') %>;
fi
<%- end -%>
exit 0;
