---
name: redis_broker

templates:
  keys/ca.crt.erb: keys/ca.crt
  keys/ca.key.erb: keys/ca.key
  config/application.yml.erb: config/application.yml
  config/log4j2.xml.erb: config/log4j2.xml
  bin/redis_broker_ctl.erb: bin/redis_broker_ctl

packages:
- openjdk
- redis_broker

provides:
- name: redis_broker_conn
  type: broker_conn
  properties:
  - user
  - password
  - bind
  - port

consumes:
- name: redis_conn
  type: conn
- name: slave_conn
  type: conn
  optional: true
- name: redis_sentinel_conn
  type: sentinel_conn
  optional: true
- name: sentinel_slave_conn
  type: sentinel_conn
  optional: true

properties:
  user:
    description: Redis service broker user
    default: "broker"
  password:
    description: Redis service broker password
  bind:
    default: false
    description: |
      Specify this property to "true" if you would like the bind address of a given instance to be automatically set to its assigned static IP. Otherwise, Redis listens only on "localhost".
  loglevel:
    default: "info"
    description: |
      Redis broker's logs level.
  port:
    default: "8080"
    description: |
      The port that this Redis broker instance will run on.
  ip_key:
    default: "hostname"
    description: |
      Redis servers IP property's key for client
  port_key:
    default: "port"
    description: |
      Redis servers port property's key for client
  password_key:
    default: "password"
    description: |
      Redis default user's password property's key for client
  admin_user_key:
    default: "admin_user"
    description: |
      Redis admin's name property's key for client
  admin_password_key:
    default: "admin_password"
    description: |
      Redis admin's password property's key for client
  ha_master_name_key:
    default: "ha_master_name"
    description: |
      Redis Sentinels IP property's key for client
  ha_port_key:
    default: "ha_port"
    description: |
      Redis Sentinels port property's key for client
  ha_password_key:
    default: "ha_password"
    description: |
      Redis Sentinels password property's key for client
  tls_keys:
    description: |
      Certificate materials for TLS connection.
    type: certificate
  tls_port_key:
    default: "tls_port"
    description: |
      Redis TLS/SSL port property's key for client
  tls_ha_port_key:
    default: "tls_ha_port"
    description: |
      Redis Sentinel TLS/SSL port property's key for client
  tls_certificate_key:
    default: "tls_certificate"
    description: |
      Redis TLS/SSL certificate property's key for client
  tls_private_key_key:
    default: "tls_private_key"
    description: |
      Redis TLS/SSL key property's key for client
  tls_ca_key:
    default: "tls_ca"
    description: |
      Redis TLS/SSL CA certificate property's key for client
